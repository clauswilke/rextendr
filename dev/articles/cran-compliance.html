<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>CRAN compliant extendr packages • rextendr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="CRAN compliant extendr packages">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rextendr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.1.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cran-compliance.html">CRAN compliant extendr packages</a></li>
    <li><a class="dropdown-item" href="../articles/package.html">Using Rust code in R packages</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown.html">Using Rust code in R Markdown documents</a></li>
    <li><a class="dropdown-item" href="../articles/setting_up_rust.html">Setting up a Rust build environment</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/extendr/rextendr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CRAN compliant extendr packages</h1>
                        <h4 data-toc-skip class="author">Josiah
Parry</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/extendr/rextendr/blob/main/vignettes/articles/cran-compliance.Rmd" class="external-link"><code>vignettes/articles/cran-compliance.Rmd</code></a></small>
      <div class="d-none name"><code>cran-compliance.Rmd</code></div>
    </div>

    
    
<p>In order for Rust-based packages to exist on CRAN, there are a number
of fairly stringent requirements that must be adhered to. CRAN published
<a href="https://cran.r-project.org/web/packages/using_rust.html" class="external-link">Using
Rust in CRAN packages</a> in mid-2023, outlining their requirements for
building and hosting Rust-based packages.</p>
<p>This article describes CRAN requirements as of the day of writing and
illustrates how <a href="https://extendr.github.io/rextendr/" class="external-link">rextendr</a> can be used to adhere to
them.</p>
<div class="section level2">
<h2 id="systemrequirements">
<code>SystemRequirements</code><a class="anchor" aria-label="anchor" href="#systemrequirements"></a>
</h2>
<p>Building Rust-backed packages from source requires the system
dependencies <code>cargo</code> and <code>rustc</code>. CRAN has
stipulated their preferred way of tracking this is using the following
line in a packages <code>DESCRIPTION</code> file.</p>
<pre><code>SystemRequirements: Cargo (Rust's package manager), rustc</code></pre>
<p>Even though this is a free-form field, having consistency can help
the whole ecosystem keep track of Rust-based R packages.</p>
</div>
<div class="section level2">
<h2 id="cargo-and-rustc-availability">
<code>cargo</code> and <code>rustc</code> availability<a class="anchor" aria-label="anchor" href="#cargo-and-rustc-availability"></a>
</h2>
<p>In order for an R package to be built from source, <code>cargo</code>
and <code>rustc</code> need to be available to the machine compiling the
package. The expectation for R packages using external dependencies is
to have a <code>configure</code> and <code>configure.win</code> files
that check if the dependencies are available before attempting to
compile the package. If the checks fail, the build process will be
stopped prematurely.</p>
<p>CRAN expects that if <code>cargo</code> is not on the
<code>PATH</code>, the user’s home directory is checked at
<code>~/.cargo/bin</code>. The configuration files must perform these
checks.</p>
</div>
<div class="section level2">
<h2 id="cargo-build-settings">
<code>cargo build</code> settings<a class="anchor" aria-label="anchor" href="#cargo-build-settings"></a>
</h2>
<p>CRAN also imposes restrictions on how <code>cargo</code> builds
crates. CRAN has requested that no more than two logical CPUs be used in
the build process. By default, <code>cargo</code> uses multiple threads
to speed up the compilation process. CRAN policy allows for a maximum of
two. This is set using the <code>-j 2</code> option, which is passed to
<code>cargo build</code>.</p>
<p>Additionally, to minimize security risks and ensure package
stability, CRAN requires that packages be built completely offline. This
prevents external dependencies from being downloaded at compile time.
Because of this requirement, vendored dependencies must be used.</p>
</div>
<div class="section level2">
<h2 id="vendored-dependencies">Vendored dependencies<a class="anchor" aria-label="anchor" href="#vendored-dependencies"></a>
</h2>
<p>Vendoring dependencies is the act of including the dependency itself
in a package source code. In the case of Rust, dependencies are fetched
only at compile time. To enable compilation in an offline environment,
dependencies must be vendored, which is accomplished using the
<code>cargo vendor</code> command.</p>
<p><code>cargo vendor</code> creates a local directory with the default
name <code>vendor</code>, which contains the source code for each of the
recursive dependencies of the crate that is being built. For CRAN
compatibility, the <code>vendor</code> directory must be compressed
using tar xz compression and included in the source of the package.</p>
<p>During the build time, the dependencies are extracted, compiled, and
then discarded. This process is controlled by the <code>Makevars</code>
and <code>Makevars.win</code> files.</p>
</div>
<div class="section level2">
<h2 id="package-compilation">Package compilation<a class="anchor" aria-label="anchor" href="#package-compilation"></a>
</h2>
<p>All of this comes together during package compilation time, providing
all of the following requirements are met:</p>
<ul>
<li>cargo must be able to be called from a user’s home directory</li>
<li>the user’s home directory must not be modified or written to</li>
<li>the package must be compiled offline</li>
<li>no more than two logical CPUs are used</li>
<li>the versions of <code>cargo</code> and <code>rustc</code> are
printed</li>
</ul>
</div>
<div class="section level2">
<h2 id="using-cran-defaults">Using CRAN defaults<a class="anchor" aria-label="anchor" href="#using-cran-defaults"></a>
</h2>
<p>rextendr provides default CRAN compliant scaffolding via the
<code><a href="../reference/cran.html">use_cran_defaults()</a></code> function and appropriate vendoring with
<code><a href="../reference/cran.html">vendor_pkgs()</a></code>.</p>
<div class="section level3">
<h3 id="making-a-package-cran-compliant">Making a package CRAN compliant<a class="anchor" aria-label="anchor" href="#making-a-package-cran-compliant"></a>
</h3>
<p>To create a CRAN compliant R package begin by creating a new R
package. Do so by calling <code><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">usethis::create_package()</a></code>. In the
new R project, run <code><a href="../reference/use_extendr.html">rextendr::use_extendr()</a></code> to create the
minimal scaffolding necessary for a Rust-powered R package. Once you
have done this, you can now run
<code><a href="../reference/cran.html">rextendr::use_cran_defaults()</a></code>.</p>
<p><code><a href="../reference/cran.html">use_cran_defaults()</a></code> will create the
<code>configure</code> and <code>configure.win</code> files.
Additionally, it will create new <code>Makevars</code> and
<code>Makevars.win</code> that print the versions of <code>cargo</code>
and <code>rustc</code> as well as use the <code>cargo build</code>
argument <code>-j 2 --offline</code>.</p>
</div>
<div class="section level3">
<h3 id="vendoring-packages">Vendoring packages<a class="anchor" aria-label="anchor" href="#vendoring-packages"></a>
</h3>
<p>After having configured your R package to use CRAN defaults, you will
need to vendor your dependencies.</p>
<p><code><a href="../reference/cran.html">vendor_pkgs()</a></code> runs <code>cargo vendor</code> on your
behalf, compresses the <code>vendor/</code> directory, and updates the
<code>vendor-config.toml</code> file accordingly.</p>
<p>When you have added new dependencies, changed the version or source
of the crates, you should use <code><a href="../reference/cran.html">vendor_pkgs()</a></code> again. Doing so
ensures that the compressed <code>vendor.tar.xz</code> contains the
updates too. This is very important for CI and publishing to CRAN.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Claus O. Wilke, Andy Thomason, Mossa M. Reimert, Ilia Kosenkov, Malcolm Barrett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
